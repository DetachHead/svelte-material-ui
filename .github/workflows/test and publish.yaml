name: test-and-publish
on:
    - push
jobs:
    test-and-publish:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
              with:
                  node-version: 18.10
            - run: npm ci
            - run: npm run bootstrap
            - uses: actions/upload-artifact@v2
              with:
                name: build
                path: packages/*/dist
            - run: npm run check
            - name: canary publish
              run: ./node_modules/.bin/lerna publish --canary --yes
              env:
                  NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
